<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stotram/Path Transliterator + Formatter</title>
<style>
body { font-family: 'Noto Serif', serif; background: #f9f9f9; color:#333; padding:2em; max-width:900px; margin:auto; transition: background 0.3s, color 0.3s;}
body.dark { background:#121212; color:#eee; }
h1{text-align:center;margin-bottom:1em;}
.textbox-container{position:relative;margin-bottom:1em;}
textarea{width:100%;height:140px;font-size:1.1em;padding:10px;box-sizing:border-box;white-space:pre-wrap;font-family:'Noto Serif Devanagari','Noto Serif Bengali',serif;background:white;color:#333;border:1px solid #ccc;border-radius:4px;transition: background 0.3s, color 0.3s;}
body.dark textarea{background:#1e1e1e;color:#eee;border:1px solid #444;}
.copy-btn{position:absolute;top:10px;right:10px;padding:5px 10px;background:#4caf50;color:white;border:none;cursor:pointer;font-size:0.9em;border-radius:4px;transition: background 0.3s;}
.copy-btn:active{background:#45a049;}
.options-bar{display:flex;flex-wrap:wrap;justify-content:center;gap:1.5em;margin-bottom:1em;background:#eee;padding:10px;border-radius:6px;transition: background 0.3s,color 0.3s;}
body.dark .options-bar{background:#222;color:#eee;}
.options-bar label{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.95em;}
.shloka{margin-top:1.5em;margin-bottom:1.5em;padding:10px;background:white;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition: background 0.3s,color 0.3s;}
body.dark .shloka{background:#1e1e1e;color:#eee;}
.devanagari{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Devanagari',serif;}
body.dark .devanagari{color:#fff;}
.bengali{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Bengali',serif;}
body.dark .bengali{color:#fff;}
.iast{font-size:1.1em;font-style:italic;color:#555;}
body.dark .iast{color:#ccc;}
.dark-toggle{display:flex;justify-content:center;margin-bottom:1em;}
.dark-toggle button{padding:5px 10px;background:#333;color:#eee;border:none;border-radius:4px;cursor:pointer;transition: background 0.3s,color 0.3s;}
.dark-toggle button:active{background:#444;}
</style>
</head>
<body>

<h1>Stotram/Path Transliterator + Formatter</h1>

<div class="dark-toggle">
<button onclick="toggleDark()">Toggle Dark Mode</button>
</div>

<div class="textbox-container">
<textarea id="inputBox" placeholder="Paste or type text here..."></textarea>
<button class="copy-btn" onclick="copyText('inputBox', this)">Copy</button>
</div>

<div class="options-bar">
  <label><input type="checkbox" id="optDevanagari" checked> Devanagari</label>
  <label><input type="checkbox" id="optBengali"> Bengali</label>
  <label><input type="checkbox" id="optIAST" checked> IAST</label>
  <label><input type="checkbox" id="optDoubleDandaSpace"> Add space inside '॥ _ ॥' and '|| _ ||'</label>
</div>

<div class="textbox-container">
<textarea id="outputBox" placeholder="Output will appear here..." readonly></textarea>
<button class="copy-btn" onclick="copyText('outputBox', this)">Copy</button>
</div>

<script>
// ------------------- DARK MODE -------------------
function toggleDark(){ document.body.classList.toggle('dark'); }

// ------------------- SCRIPT DETECTION -------------------
function detectScript(text){
  if(/[ঀ-৿]/.test(text)) return 'ben';
  if(/[ऀ-ॿ]/.test(text)) return 'dev';
  if(/[A-Za-zāīūṛṝṅñṭḍṇśṣḥṃŗāīūŕṝoṁ]+/.test(text)) return 'iast';
  return 'unknown';
}

// ------------------- MAPPINGS -------------------
const devanagariToIASTMap = { 'क':'k','ख':'kh','ग':'g','घ':'gh','ङ':'ṅ','च':'c','छ':'ch','ज':'j','झ':'jh','ञ':'ñ','ट':'ṭ','ठ':'ṭh','ड':'ḍ','ढ':'ḍh','ण':'ṇ','त':'t','थ':'th','द':'d','ध':'dh','न':'n','प':'p','फ':'ph','ब':'b','भ':'bh','म':'m','य':'y','र':'r','ल':'l','व':'v','श':'ś','ष':'ṣ','स':'s','ह':'h','अ':'a','आ':'ā','इ':'i','ई':'ī','उ':'u','ऊ':'ū','ऋ':'ṛ','ॠ':'ṝ','ए':'e','ऐ':'ai','ओ':'o','औ':'au','ा':'ā','ि':'i','ी':'ī','ु':'u','ू':'ū','ृ':'ṛ','ॄ':'ṝ','े':'e','ै':'ai','ो':'o','ौ':'au','ं':'ṃ','ः':'ḥ','ँ':'̃','्':'','ऽ':"'",'।':'|','॥':'||','०':'0','१':'1','२':'2','३':'3','४':'4','५':'5','६':'6','७':'7','८':'8','९':'9'};

const devanagariToBengaliMap = { 'क':'ক','ख':'খ','ग':'গ','घ':'ঘ','ङ':'ঙ','च':'চ','छ':'ছ','ज':'জ','ঝ':'ঝ','ञ':'ঞ','ट':'ট','ठ':'ঠ','ड':'ড','ढ':'ঢ','ण':'ণ','त':'ত','थ':'থ','द':'দ','ध':'ধ','न':'ন','प':'প','फ':'ফ','ब':'ব','भ':'ভ','म':'ম','य':'য','र':'র','ল':'ল','व':'ব','श':'শ','ष':'ষ','स':'স','ह':'হ','अ':'অ','आ':'আ','इ':'ই','ई':'ঈ','उ':'উ','ऊ':'ঊ','ऋ':'ঋ','ॠ':'ৠ','ए':'এ','ऐ':'ঐ','ओ':'ও','औ':'ঔ','ा':'া','ि':'ি','ी':'ী','ु':'ু','ू':'ূ','ृ':'ৃ','ॄ':'ৄ','े':'ে','ै':'ৈ','ो':'ো','ौ':'ৌ','ं':'ং','ः':'ঃ','ँ':'ঁ','्':'','ऽ':"'",'।':'।','॥':'॥','०':'০','१':'১','२':'২','३':'৩','४':'৪','५':'৫','৬':'৬','७':'৭','८':'৮','৯':'৯'};

const iastToDevanagariMap = {'k':'क','kh':'ख','g':'ग','gh':'घ','ṅ':'ङ','c':'च','ch':'छ','j':'ज','jh':'झ','ñ':'ञ','ṭ':'ट','ṭh':'ठ','ḍ':'ड','ḍh':'ढ','ṇ':'ण','t':'त','th':'थ','d':'द','dh':'ध','n':'न','p':'प','ph':'फ','b':'ब','bh':'भ','m':'म','y':'य','r':'र','l':'ल','v':'व','ś':'श','ṣ':'ष','s':'स','h':'ह','a':'अ','ā':'आ','i':'इ','ī':'ई','u':'उ','ū':'ऊ','ṛ':'ऋ','ṝ':'ॠ','e':'ए','ai':'ऐ','o':'ओ','au':'औ','ṃ':'ं','ḥ':'ः','oṃ':'ॐ'};
const iastToBengaliMap = {'k':'ক','kh':'খ','g':'গ','gh':'ঘ','ṅ':'ঙ','c':'চ','ch':'ছ','j':'জ','jh':'ঝ','ñ':'ঞ','ṭ':'ট','ṭh':'ঠ','ḍ':'ড','ḍh':'ঢ','ṇ':'ণ','t':'ত','th':'থ','d':'দ','dh':'ধ','n':'ন','p':'প','ph':'ফ','b':'ব','bh':'ভ','m':'ম','y':'য','r':'র','l':'ল','v':'ব','ś':'শ','ṣ':'ষ','s':'স','h':'হ','a':'অ','ā':'আ','i':'ই','ī':'ঈ','u':'উ','ū':'ঊ','ṛ':'ঋ','ṝ':'ৠ','e':'এ','ai':'ঐ','o':'ও','au':'ঔ','ṃ':'ং','ḥ':'ঃ','oṃ':'ওঁ'};

// ------------------- TRANS FUNCTIONS -------------------
function devanagariToIAST(text){ text=text.replace(/ॐ/g,'oṃ'); let out=''; const chars=Array.from(text); for(let i=0;i<chars.length;i++){ const c=chars[i]; const next=chars[i+1]; let m=devanagariToIASTMap[c]||c; if(/[क-ह]/.test(c)){ if(next==='्') out+=m; else if(/[ािीुूृॄेैोौ]/.test(next)) out+=m; else out+=m+'a'; }else if(/[ािीुूृॄेैोौ]/.test(c)) out+=m; else if(c==='्') continue; else out+=m; } return out; }
function devanagariToBengali(text){ text=text.replace(/ॐ/g,'ওঁ'); const map=devanagariToBengaliMap; let out=''; let i=0; while(i<text.length){ let c=text[i]; let next=text[i+1]; let next2=text[i+2]; let mapped=map[c]||c; if(c==='्'){ i++; continue; } if(next==='্'){ if(next2==='য') mapped+='্য',i+=2; else if(next2==='র') mapped+='্র',i+=2; else if(next2==='ল') mapped+='্ল',i+=2; else mapped+='',i++; } out+=mapped; i++; } return fixBengali(out); }
function transliterateIASTtoDevanagari(text){ text=text.replace(/oṃ/g,'ॐ'); for(const key in iastToDevanagariMap){ text=text.split(key).join(iastToDevanagariMap[key]); } return text; }
function transliterateIASTtoBengali(text){ text=text.replace(/oṃ/g,'ওঁ'); for(const key in iastToBengaliMap){ text=text.split(key).join(iastToBengaliMap[key]); } return fixBengali(text); }
function fixBengali(text){ return text.replace(/([ক-হ])\1+/g,'$1'); }

// ------------------- COPY BUTTON -------------------
function copyText(id, btn){
  const textarea=document.getElementById(id);
  navigator.clipboard.writeText(textarea.value).then(()=>{
    const old=btn.textContent;
    btn.textContent='Copied!';
    setTimeout(()=>{btn.textContent=old;},1000);
  });
}

// ------------------- PROCESS INPUT -------------------
function processInput(){
  const inputText=document.getElementById("inputBox").value.trim();
  if(!inputText){document.getElementById("outputBox").value='';return;}
  const doubleDanda=document.getElementById("optDoubleDandaSpace").checked;

  let clusters=inputText.split(/\n{2,}/).map(c=>c.trim()).filter(c=>c);
  let output='';
  const script=detectScript(inputText);

  clusters.forEach(cluster=>{
    let lines=cluster.split('\n').map(l=>l.trim());
    let clusterText=lines.join('\n');

    // ---- DOUBLE-DANDA FIX ----
    if(doubleDanda){
      clusterText = clusterText.replace(/॥\s*(\d*)\s*॥/g, (_, num)=> num ? `॥ ${num} ॥` : '॥  ॥');
      clusterText = clusterText.replace(/\|\|\s*(\d*)\s*\|\|/g, (_, num)=> num ? `|| ${num} ||` : '||  ||');
    }

    // ---- OUTPUT TRANSLITERATION ----
    let clusterOutput='';
    if(script==='iast'){
      if(document.getElementById("optDevanagari").checked) clusterOutput+=transliterateIASTtoDevanagari(clusterText)+'\n';
      if(document.getElementById("optBengali").checked) clusterOutput+=transliterateIASTtoBengali(clusterText)+'\n';
      if(document.getElementById("optIAST").checked) clusterOutput+=clusterText+'\n';
    }else{
      if(document.getElementById("optDevanagari").checked) clusterOutput+=clusterText+'\n';
      if(document.getElementById("optBengali").checked) clusterOutput+=devanagariToBengali(clusterText)+'\n';
      if(document.getElementById("optIAST").checked) clusterOutput+=devanagariToIAST(clusterText)+'\n';
    }

    output+=clusterOutput.trim()+'\n\n';
  });

  document.getElementById("outputBox").value=output.trim();
}

// ------------------- AUTO-PROCESS -------------------
document.getElementById("inputBox").addEventListener('input',processInput);
document.getElementById("optDevanagari").addEventListener('change',processInput);
document.getElementById("optBengali").addEventListener('change',processInput);
document.getElementById("optIAST").addEventListener('change',processInput);
document.getElementById("optDoubleDandaSpace").addEventListener('change',processInput);
</script>
</body>
</html>
