<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stotram/Path Transliterator + Formatter</title>
<style>
body { font-family:'Noto Serif',serif; background:#f9f9f9; color:#333; padding:2em; max-width:900px; margin:auto; transition: background 0.3s, color 0.3s;}
body.dark { background:#121212; color:#eee;}
h1{text-align:center;margin-bottom:1em;}
.textbox-container{position:relative;margin-bottom:1em;}
textarea{width:100%;height:140px;font-size:1.1em;padding:10px;box-sizing:border-box;white-space:pre-wrap;font-family:'Noto Serif Devanagari','Noto Serif Bengali','Noto Serif',serif;background:white;color:#333;border:1px solid #ccc;border-radius:4px;transition: background 0.3s, color 0.3s;}
body.dark textarea{background:#1e1e1e;color:#eee;border:1px solid #444;}
.copy-btn{position:absolute;top:10px;right:10px;padding:5px 10px;background:#4caf50;color:white;border:none;cursor:pointer;font-size:0.9em;border-radius:4px;transition: background 0.3s;}
.copy-btn:active{background:#45a049;}
.options-bar{display:flex;flex-wrap:wrap;justify-content:center;gap:1.5em;margin-bottom:1em;background:#eee;padding:10px;border-radius:6px;transition: background 0.3s,color 0.3s;}
body.dark .options-bar{background:#222;color:#eee;}
.options-bar label{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.95em;}
.shloka{margin-top:1.5em;margin-bottom:1.5em;padding:10px;background:white;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition: background 0.3s,color 0.3s;}
body.dark .shloka{background:#1e1e1e;color:#eee;}
.devanagari{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Devanagari',serif;}
body.dark .devanagari{color:#fff;}
.bengali{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Bengali',serif;}
body.dark .bengali{color:#fff;}
.iast{font-size:1.1em;font-style:italic;color:#555;}
body.dark .iast{color:#ccc;}
.dark-toggle{display:flex;justify-content:center;margin-bottom:1em;}
.dark-toggle button{padding:5px 10px;background:#333;color:#eee;border:none;border-radius:4px;cursor:pointer;transition: background 0.3s,color 0.3s;}
.dark-toggle button:active{background:#444;}
</style>
</head>
<body>

<h1>Stotram/Path Transliterator + Formatter</h1>

<div class="dark-toggle">
<button onclick="toggleDark()">Toggle Dark Mode</button>
</div>

<div class="textbox-container">
<textarea id="inputBox" placeholder="Paste or type text here..."></textarea>
<button class="copy-btn" onclick="copyText('inputBox', this)">Copy</button>
</div>

<div class="options-bar">
<label><input type="checkbox" id="optDevanagari" checked> Devanagari</label>
<label><input type="checkbox" id="optBengali"> Bengali</label>
<label><input type="checkbox" id="optIAST" checked> IAST</label>
<label><input type="checkbox" id="optDoubleDandaSpace"> Add space inside '॥ _ ॥' and '|| _ ||'</label>
</div>

<div class="textbox-container">
<textarea id="outputBox" placeholder="Output will appear here..." readonly></textarea>
<button class="copy-btn" onclick="copyText('outputBox', this)">Copy</button>
</div>

<script>
// DARK MODE
function toggleDark(){ document.body.classList.toggle('dark'); }

// SCRIPT DETECTION
function detectScript(text){
  if(/[ঀ-৿]/.test(text)) return 'ben';
  if(/[ऀ-ॿ]/.test(text)) return 'dev';
  if(/[A-Za-zāīūṛṝṅñṭḍṇśṣḥṃŕōṁ]+/.test(text)) return 'iast';
  return 'unknown';
}

// DEV → IAST
function devanagariToIAST(text){
  text=text.replace(/ॐ/g,'oṃ');
  return text.replace(/([क-ह])([ािीुूृॄेैोौ]?)(्?)/g, (_, cons, vowel, virama)=>{
    const c={'क':'k','ख':'kh','ग':'g','घ':'gh','ङ':'ṅ','च':'c','छ':'ch','ज':'j','झ':'jh','ञ':'ñ','ट':'ṭ','ठ':'ṭh','ड':'ḍ','ढ':'ḍh','ण':'ṇ','त':'t','थ':'th','द':'d','ध':'dh','न':'n','प':'p','फ':'ph','ब':'b','भ':'bh','म':'m','य':'y','र':'r','ल':'l','व':'v','श':'ś','ष':'ṣ','स':'s','ह':'h'};
    const v={'':'a','ा':'ā','ि':'i','ी':'ī','ु':'u','ू':'ū','ृ':'ṛ','ॄ':'ṝ','े':'e','ै':'ai','ो':'o','ौ':'au'};
    let res=c[cons]||cons;
    if(virama)return res;
    res+=v[vowel]||vowel;
    return res;
  }).replace(/[ं]/g,'ṃ').replace(/[ः]/g,'ḥ').replace(/[ँ]/g,'̃').replace(/[।]/g,'|').replace(/[॥]/g,'||');
}

// DEV → BEN
function devanagariToBengali(text){
  text=text.replace(/ॐ/g,'ওঁ');
  return text.replace(/([क-ह])([ािीुूृॄेैोौ]?)(्?)/g, (_, cons, vowel, virama)=>{
    const c={'क':'ক','ख':'খ','ग':'গ','घ':'ঘ','ङ':'ঙ','च':'চ','छ':'ছ','ज':'জ','झ':'ঝ','ञ':'ঞ','ट':'ট','ठ':'ঠ','ड':'ড','ढ':'ঢ','ण':'ণ','त':'ত','थ':'থ','द':'দ','ध':'ধ','न':'ন','प':'প','फ':'ফ','ब':'ব','भ':'ভ','म':'ম','य':'য','र':'র','ल':'ল','व':'ব','श':'শ','ष':'ষ','स':'স','ह':'হ'};
    const v={'':'অ','ा':'া','ि':'ি','ी':'ী','ु':'ু','ू':'ূ','ृ':'ৃ','ॄ':'ৄ','े':'ে','ै':'ৈ','ो':'ো','ौ':'ৌ'};
    let res=c[cons]||cons;
    if(virama)return res;
    res+=v[vowel]||vowel;
    return res;
  }).replace(/[ं]/g,'ং').replace(/[ः]/g,'ঃ').replace(/[ँ]/g,'ঁ').replace(/[।]/g,'।').replace(/[॥]/g,'॥');
}

// IAST → DEV/BEN
function transliterateIASTtoDevanagari(text){
  const revMap=Object.entries({'क':'k','ख':'kh','ग':'g','घ':'gh','ङ':'ṅ','च':'c','छ':'ch','ज':'j','झ':'jh','ञ':'ñ','ट':'ṭ','ठ':'ṭh','ड':'ḍ','ढ':'ḍh','ण':'ṇ','त':'t','थ':'th','द':'d','ध':'dh','न':'n','प':'p','फ':'ph','ब':'b','भ':'bh','म':'m','य':'y','र':'r','ल':'l','व':'v','श':'ś','ष':'ṣ','स':'s','ह':'h'}).reduce((a,[k,v])=>{a[v]=k;return a;},{});
  const vowels={'a':'अ','ā':'आ','i':'इ','ī':'ई','u':'उ','ū':'ऊ','ṛ':'ऋ','ṝ':'ॠ','e':'ए','ai':'ऐ','o':'ओ','au':'औ'};
  text=text.replace(/oṃ/g,'ॐ');
  for(const [v,c] of Object.entries(vowels)) text=text.replace(new RegExp(v,'g'),c);
  for(const [v,c] of Object.entries(revMap)) text=text.replace(new RegExp(v,'g'),c);
  return text;
}

function transliterateIASTtoBengali(text){
  const revMap=Object.entries({'ক':'k','খ':'kh','গ':'g','ঘ':'gh','ঙ':'ṅ','চ':'c','ছ':'ch','জ':'j','ঝ':'jh','ঞ':'ñ','ট':'ṭ','ঠ':'ṭh','ড':'ḍ','ঢ':'ḍh','ণ':'ṇ','ত':'t','থ':'th','দ':'d','ধ':'dh','ন':'n','প':'p','ফ':'ph','ব':'b','ভ':'bh','ম':'m','য':'y','র':'r','ল':'l','ব':'v','শ':'ś','ষ':'ṣ','স':'s','হ':'h'}).reduce((a,[k,v])=>{a[v]=k;return a;},{});
  const vowels={'a':'অ','ā':'আ','i':'ই','ī':'ঈ','u':'উ','ū':'ঊ','ṛ':'ঋ','ṝ':'ৠ','e':'এ','ai':'ঐ','o':'ও','au':'ঔ'};
  text=text.replace(/oṃ/g,'ওঁ');
  for(const [v,c] of Object.entries(vowels)) text=text.replace(new RegExp(v,'g'),c);
  for(const [v,c] of Object.entries(revMap)) text=text.replace(new RegExp(v,'g'),c);
  return text;
}

// PROCESS INPUT
function processInput(){
  const txt=document.getElementById('inputBox').value.trim();
  if(!txt)return;
  const outBox=document.getElementById('outputBox');
  const opts={dev:document.getElementById('optDevanagari').checked,
              ben:document.getElementById('optBengali').checked,
              iast:document.getElementById('optIAST').checked,
              danda:document.getElementById('optDoubleDandaSpace').checked};
  const script=detectScript(txt);
  const lines=txt.split(/\n{1,}/).filter(l=>l.trim()!=='');
  let output='';
  for(const l of lines){
    let dev=script==='iast'?transliterateIASTtoDevanagari(l):l;
    let ben=script==='iast'?transliterateIASTtoBengali(l):devanagariToBengali(l);
    let iast=script==='dev'?devanagariToIAST(l):l;
    if(opts.danda){
      dev=dev.replace(/॥\s*(\d+)\s*॥/g,'॥ $1 ॥').replace(/\|\|\s*(\d+)\s*\|\|/g,'|| $1 ||');
      ben=ben.replace(/॥\s*(\d+)\s*॥/g,'॥ $1 ॥').replace(/\|\|\s*(\d+)\s*\|\|/g,'|| $1 ||');
      iast=iast.replace(/॥\s*(\d+)\s*॥/g,'॥ $1 ॥').replace(/\|\|\s*(\d+)\s*\|\|/g,'|| $1 ||');
    }
    let block='';
    if(opts.dev) block+=dev+'\n';
    if(opts.ben) block+=ben+'\n';
    if(opts.iast) block+=iast+'\n';
    output+=block+'\n';
  }
  outBox.value=output.trim();
}

// COPY FUNCTION
function copyText(id, btn){
  const text=document.getElementById(id);
  navigator.clipboard.writeText(text.value);
  const old=btn.innerText;
  btn.innerText='Copied!';
  setTimeout(()=>{btn.innerText=old;},1000);
}
</script>

</body>
</html>
