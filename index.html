<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stotram/Path Transliterator + Formatter</title>
<style>
body { font-family:'Noto Serif',serif; background:#f9f9f9; color:#333; padding:2em; max-width:900px; margin:auto; transition: background 0.3s, color 0.3s;}
body.dark { background:#121212; color:#eee;}
h1{text-align:center;margin-bottom:1em;}
.textbox-container{position:relative;margin-bottom:1em;}
textarea{width:100%;height:140px;font-size:1.1em;padding:10px;box-sizing:border-box;white-space:pre-wrap;font-family:'Noto Serif Devanagari','Noto Serif Bengali','Noto Serif',serif;background:white;color:#333;border:1px solid #ccc;border-radius:4px;transition: background 0.3s, color 0.3s;}
body.dark textarea{background:#1e1e1e;color:#eee;border:1px solid #444;}
.copy-btn{position:absolute;top:10px;right:10px;padding:5px 10px;background:#4caf50;color:white;border:none;cursor:pointer;font-size:0.9em;border-radius:4px;transition: background 0.3s;}
.copy-btn:active{background:#45a049;}
.options-bar{display:flex;flex-wrap:wrap;justify-content:center;gap:1.5em;margin-bottom:1em;background:#eee;padding:10px;border-radius:6px;transition: background 0.3s,color 0.3s;}
body.dark .options-bar{background:#222;color:#eee;}
.options-bar label{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.95em;}
.shloka{margin-top:1.5em;margin-bottom:1.5em;padding:10px;background:white;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition: background 0.3s,color 0.3s;}
body.dark .shloka{background:#1e1e1e;color:#eee;}
.devanagari{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Devanagari',serif;}
body.dark .devanagari{color:#fff;}
.bengali{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Bengali',serif;}
body.dark .bengali{color:#fff;}
.iast{font-size:1.1em;font-style:italic;color:#555;}
body.dark .iast{color:#ccc;}
.dark-toggle{display:flex;justify-content:center;margin-bottom:1em;}
.dark-toggle button{padding:5px 10px;background:#333;color:#eee;border:none;border-radius:4px;cursor:pointer;transition: background 0.3s,color 0.3s;}
.dark-toggle button:active{background:#444;}
</style>
</head>
<body>

<h1>Stotram/Path Transliterator + Formatter</h1>

<div class="dark-toggle">
<button onclick="toggleDark()">Toggle Dark Mode</button>
</div>

<div class="textbox-container">
<textarea id="inputBox" placeholder="Paste or type text here..."></textarea>
<button class="copy-btn" onclick="copyText('inputBox', this)">Copy</button>
</div>

<div class="options-bar">
<label><input type="checkbox" id="optDevanagari" checked> Devanagari</label>
<label><input type="checkbox" id="optBengali"> Bengali</label>
<label><input type="checkbox" id="optIAST" checked> IAST</label>
<label><input type="checkbox" id="optDoubleDandaSpace"> Add space inside '॥ _ ॥' and '|| _ ||'</label>
</div>

<div class="textbox-container">
<textarea id="outputBox" placeholder="Output will appear here..." readonly></textarea>
<button class="copy-btn" onclick="copyText('outputBox', this)">Copy</button>
</div>

<script>
// ------------------- DARK MODE -------------------
function toggleDark(){ document.body.classList.toggle('dark'); }

// ------------------- SCRIPT DETECTION -------------------
function detectScript(text){
  if(/[ঀ-৿]/.test(text)) return 'ben';
  if(/[ऀ-ॿ]/.test(text)) return 'dev';
  if(/[A-Za-zāīūṛṝṅñṭḍṇśṣḥṃŕō]+/.test(text)) return 'iast';
  return 'unknown';
}

// ------------------- TRANSLITERATION MAPS -------------------
// Full Devanagari → IAST
const devToIASTMap = {
  'अ':'a','आ':'ā','इ':'i','ई':'ī','उ':'u','ऊ':'ū','ऋ':'ṛ','ॠ':'ṝ',
  'ए':'e','ऐ':'ai','ओ':'o','औ':'au','क':'k','ख':'kh','ग':'g','घ':'gh','ङ':'ṅ',
  'च':'c','छ':'ch','ज':'j','झ':'jh','ञ':'ñ','ट':'ṭ','ठ':'ṭh','ड':'ḍ','ढ':'ḍh','ण':'ṇ',
  'त':'t','थ':'th','द':'d','ध':'dh','न':'n','प':'p','फ':'ph','ब':'b','भ':'bh','म':'m',
  'य':'y','र':'r','ल':'l','व':'v','श':'ś','ष':'ṣ','स':'s','ह':'h',
  'ा':'ā','ि':'i','ी':'ī','ु':'u','ू':'ū','ृ':'ṛ','ॄ':'ṝ','े':'e','ै':'ai','ो':'o','ौ':'au',
  'ं':'ṃ','ः':'ḥ','ँ':'̃','्':'','।':'|','॥':'||','०':'0','१':'1','२':'2','३':'3','४':'4',
  '५':'5','६':'6','७':'7','८':'8','९':'9','ॐ':'oṃ'
};

// Full Devanagari → Bengali
const devToBenMap = {
  'अ':'অ','आ':'আ','इ':'ই','ई':'ঈ','उ':'উ','ऊ':'ঊ','ऋ':'ঋ','ॠ':'ৠ',
  'ए':'এ','ऐ':'ঐ','ओ':'ও','औ':'ঔ','क':'ক','ख':'খ','ग':'গ','घ':'ঘ','ङ':'ঙ',
  'च':'চ','छ':'ছ','ज':'জ','झ':'ঝ','ञ':'ঞ','ट':'ট','ठ':'ঠ','ड':'ড','ढ':'ঢ','ण':'ণ',
  'त':'ত','थ':'থ','द':'দ','ध':'ধ','न':'ন','प':'প','फ':'ফ','ब':'ব','भ':'ভ','म':'ম',
  'य':'য','र':'র','ल':'ল','व':'ব','श':'শ','ष':'ষ','स':'স','ह':'হ',
  'ा':'া','ि':'ি','ी':'ী','ु':'ু','ू':'ূ','ृ':'ৃ','ॄ':'ৄ','े':'ে','ै':'ৈ','ो':'ো','ौ':'ৌ',
  'ं':'ং','ः':'ঃ','ँ':'ঁ','्':'','।':'।','॥':'॥','०':'০','१':'১','२':'২','३':'৩','৪':'৪',
  '५':'৫','६':'৬','৭':'৭','৮':'৮','९':'৯','ॐ':'ওঁ'
};

function devanagariToIAST(text){ return text.split('').map(c=>devToIASTMap[c]||c).join(''); }
function devanagariToBengali(text){ return text.split('').map(c=>devToBenMap[c]||c).join(''); }
function transliterateIASTtoDevanagari(text){
  let revMap = Object.entries(devToIASTMap).reduce((a,[k,v])=>{a[v]=k;return a;},{});
  // sort by length descending to handle multi-character vowels first
  return Object.keys(revMap).sort((a,b)=>b.length-a.length).reduce((t,k)=>t.replaceAll(k,revMap[k]), text);
}
function transliterateIASTtoBengali(text){
  let revMap = Object.entries(devToBenMap).reduce((a,[k,v])=>{a[devToIASTMap[k]]=v;return a;},{});
  return Object.keys(revMap).sort((a,b)=>b.length-a.length).reduce((t,k)=>t.replaceAll(k,revMap[k]), text);
}

// ------------------- COPY BUTTON -------------------
function copyText(id, btn){
  const textarea=document.getElementById(id);
  navigator.clipboard.writeText(textarea.value).then(()=>{
    const old=btn.textContent;
    btn.textContent='Copied!';
    setTimeout(()=>{btn.textContent=old;},1000);
  });
}

// ------------------- PROCESS INPUT -------------------
function processInput(){
  const inputText=document.getElementById("inputBox").value.trim();
  if(!inputText){document.getElementById("outputBox").value='';return;}
  const doubleDanda=document.getElementById("optDoubleDandaSpace").checked;

  let clusters=inputText.split(/\n{2,}/).map(c=>c.trim()).filter(c=>c);
  let output='';
  const script=detectScript(inputText);

  clusters.forEach(cluster=>{
    let clusterText=cluster.replace(/\s+$/gm,'');
    if(doubleDanda){
      clusterText=clusterText.replace(/॥\s*([\d०-৯]*)\s*॥/g, (_, num)=>num?`॥ ${num} ॥`:'॥  ॥');
      clusterText=clusterText.replace(/\|\|\s*(\d*)\s*\|\|/g, (_, num)=>num?`|| ${num} ||`:'||  ||');
    }

    if(document.getElementById("optDevanagari").checked){
      if(script==='iast') output+=transliterateIASTtoDevanagari(clusterText)+'\n';
      else output+=clusterText+'\n';
    }
    if(document.getElementById("optBengali").checked){
      if(script==='iast') output+=transliterateIASTtoBengali(clusterText)+'\n';
      else if(script==='dev') output+=devanagariToBengali(clusterText)+'\n';
      else output+=clusterText+'\n';
    }
    if(document.getElementById("optIAST").checked){
      if(script==='dev') output+=devanagariToIAST(clusterText)+'\n';
      else output+=clusterText+'\n';
    }
    output+='\n';
  });

  document.getElementById("outputBox").value=output.trim();
}

// ------------------- AUTO-PROCESS -------------------
document.getElementById("inputBox").addEventListener('input',processInput);
document.getElementById("optDevanagari").addEventListener('change',processInput);
document.getElementById("optBengali").addEventListener('change',processInput);
document.getElementById("optIAST").addEventListener('change',processInput);
document.getElementById("optDoubleDandaSpace").addEventListener('change',processInput);
</script>
</body>
</html>
