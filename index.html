<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stotram/Path Transliterator + Formatter</title>
  <style>
    body {
      font-family: 'Noto Serif', serif;
      background: #f9f9f9;
      color: #333;
      padding: 2em;
      max-width: 800px;
      margin: auto;
    }

    textarea {
      width: 100%;
      height: 160px;
      font-size: 1.1em;
      padding: 10px;
      font-family: 'Noto Serif Devanagari', serif;
      white-space: pre-wrap;
    }

    .options-bar {
      margin-top: 15px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    select {
      padding: 6px 10px;
      font-size: 1em;
    }

    button {
      padding: 10px 20px;
      font-size: 1em;
      background: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
    }

    .shloka {
      margin-top: 2em;
      margin-bottom: 1.5em;
      white-space: pre-wrap;
    }

    .devanagari {
      font-size: 1.3em;
      font-weight: bold;
      color: #222;
      white-space: pre-wrap;
    }

    .iast {
      font-size: 1.1em;
      font-style: italic;
      color: #555;
      white-space: pre-wrap;
    }

    .bengali {
      font-size: 1.2em;
      font-family: 'Noto Serif Bengali', serif;
      color: #333;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h1>Stotram/Path Transliterator + Formatter</h1>
  <p>Paste or type Devanagari shloka below:</p>

  <textarea id="devInput" placeholder="Enter text here"></textarea>

  <div class="options-bar">
    <label for="scriptSelect">Output:</label>
    <select id="scriptSelect">
      <option value="both" selected>Devanagari + IAST</option>
      <option value="devanagari">Devanagari only</option>
      <option value="iast">IAST only</option>
      <option value="bengali">Bengali</option>
    </select>
    <button onclick="processInput()">Transliterate</button>
  </div>

  <div id="output"></div>

  <script>
    // Consonants and vowels for Devanagari -> IAST
    const consonants = {
      'क': 'k', 'ख': 'kh', 'ग': 'g', 'घ': 'gh', 'ङ': 'ṅ',
      'च': 'c', 'छ': 'ch', 'ज': 'j', 'झ': 'jh', 'ञ': 'ñ',
      'ट': 'ṭ', 'ठ': 'ṭh', 'ड': 'ḍ', 'ढ': 'ḍh', 'ण': 'ṇ',
      'त': 't', 'थ': 'th', 'द': 'd', 'ध': 'dh', 'न': 'n',
      'प': 'p', 'फ': 'ph', 'ब': 'b', 'भ': 'bh', 'म': 'm',
      'य': 'y', 'र': 'r', 'ल': 'l', 'व': 'v',
      'श': 'ś', 'ष': 'ṣ', 'स': 's', 'ह': 'h'
    };

    const vowels = {
      'अ': 'a', 'आ': 'ā', 'इ': 'i', 'ई': 'ī',
      'उ': 'u', 'ऊ': 'ū', 'ऋ': 'ṛ', 'ॠ': 'ṝ',
      'ए': 'e', 'ऐ': 'ai', 'ओ': 'o', 'औ': 'au'
    };

    const vowelSigns = {
      'ा': 'ā', 'ि': 'i', 'ी': 'ī', 'ु': 'u', 'ू': 'ū',
      'ृ': 'ṛ', 'ॄ': 'ṝ', 'े': 'e', 'ै': 'ai', 'ो': 'o', 'ौ': 'au'
    };

    const specials = {
      'ं': 'ṃ', 'ः': 'ḥ', 'ँ': '̃',
      '।': '|', '॥': '||',
      '०': '0', '१': '1', '२': '2', '३': '3', '४': '4',
      '५': '5', '६': '6', '७': '7', '८': '8', '९': '9',
      'ऽ': "'",
      'ॐ': 'oṃ'
    };

    // IAST -> Bengali transliteration
    const iastToBengaliMap = [
      // Order matters: handle longer sequences first
      [/ai/g, 'ৈ'], [/au/g, 'ৌ'],
      [/ā/g, 'া'], [/ī/g, 'ী'], [/i/g, 'ি'],
      [/ū/g, 'ূ'], [/u/g, 'ু'],
      [/ṛ/g, 'ৃ'],
      [/e/g, 'ে'], [/o/g, 'ো'],

      [/kh/g, 'খ'], [/gh/g, 'ঘ'], [/ch/g, 'ছ'],
      [/jh/g, 'ঝ'], [/ṭh/g, 'ঠ'], [/ḍh/g, 'ঢ'],
      [/th/g, 'থ'], [/dh/g, 'ধ'], [/ph/g, 'ফ'], [/bh/g, 'ভ'],

      [/k/g, 'ক'], [/g/g, 'গ'], [/ṅ/g, 'ঙ'],
      [/c/g, 'চ'], [/j/g, 'জ'], [/ñ/g, 'ঞ'],
      [/ṭ/g, 'ট'], [/ḍ/g, 'ড'], [/ṇ/g, 'ণ'],
      [/t/g, 'ত'], [/d/g, 'দ'], [/n/g, 'ন'],
      [/p/g, 'প'], [/b/g, 'ব'], [/m/g, 'ম'],
      [/y/g, 'য'], [/r/g, 'র'], [/l/g, 'ল'], [/v/g, 'ব'],
      [/ś/g, 'শ'], [/ṣ/g, 'ষ'], [/s/g, 'স'], [/h/g, 'হ'],
      [/ṃ/g, 'ং'], [/ḥ/g, 'ঃ'], [/'/g, '’'],
      [/\|/g, '।'], [/oṃ/g, 'ওঁ']
    ];

    function devanagariToIAST(text) {
      let result = '';
      for (let i = 0; i < text.length; i++) {
        const char = text[i];

        if (vowels[char]) {
          result += vowels[char];
        }
        else if (consonants[char]) {
          let translit = consonants[char];
          const next = text[i + 1];

          if (next && vowelSigns[next]) {
            translit += vowelSigns[next];
            i++;
          } else if (next === '्') {
            i++;
          } else {
            translit += 'a';
          }
          result += translit;
        }
        else if (vowelSigns[char]) {
          result += vowelSigns[char];
        }
        else if (specials[char]) {
          result += specials[char];
        }
        else {
          result += char;
        }
      }
      return result;
    }

    function iastToBengali(text) {
      let output = text;
      for (const [regex, rep] of iastToBengaliMap) {
        output = output.replace(regex, rep);
      }
      return output;
    }

    function processInput() {
      const rawText = document.getElementById("devInput").value.trim();
      const mode = document.getElementById("scriptSelect").value;
      if (!rawText) return;

      const clusters = rawText
        .split(/\n\s*\n/)
        .map(cluster => cluster.split('\n').map(line => line.trim()).join('\n'))
        .filter(c => c.length > 0);

      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML = '';

      clusters.forEach(cluster => {
        const shlokaBlock = document.createElement("div");
        shlokaBlock.className = "shloka";

        if (mode === 'devanagari' || mode === 'both') {
          const devEl = document.createElement("div");
          devEl.className = "devanagari";
          devEl.textContent = cluster;
          shlokaBlock.appendChild(devEl);
        }

        if (mode === 'iast' || mode === 'both' || mode === 'bengali') {
          const iast = devanagariToIAST(cluster);
          if (mode === 'iast' || mode === 'both') {
            const iastEl = document.createElement("div");
            iastEl.className = "iast";
            iastEl.textContent = iast;
            shlokaBlock.appendChild(iastEl);
          }
          if (mode === 'bengali') {
            const bengEl = document.createElement("div");
            bengEl.className = "bengali";
            bengEl.textContent = iastToBengali(iast);
            shlokaBlock.appendChild(bengEl);
          }
        }

        outputDiv.appendChild(shlokaBlock);
      });
    }
  </script>

</body>
</html>
