<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stotram/Path Transliterator + Formatter</title>
<style>
body { font-family: 'Noto Serif', serif; background: #f9f9f9; color:#333; padding:2em; max-width:900px; margin:auto; transition: background 0.3s, color 0.3s;}
body.dark { background:#121212; color:#eee; }
h1{text-align:center;margin-bottom:1em;}
.textbox-container{position:relative;margin-bottom:1em;}
textarea{width:100%;height:140px;font-size:1.1em;padding:10px;box-sizing:border-box;white-space:pre-wrap;font-family:'Noto Serif Devanagari','Noto Serif Bengali',serif;background:white;color:#333;border:1px solid #ccc;border-radius:4px;transition: background 0.3s, color 0.3s;}
body.dark textarea{background:#1e1e1e;color:#eee;border:1px solid #444;}
.copy-btn{position:absolute;top:10px;right:10px;padding:5px 10px;background:#4caf50;color:white;border:none;cursor:pointer;font-size:0.9em;border-radius:4px;transition: background 0.3s;}
.copy-btn:active{background:#45a049;}
.options-bar{display:flex;flex-wrap:wrap;justify-content:center;gap:1.5em;margin-bottom:1em;background:#eee;padding:10px;border-radius:6px;transition: background 0.3s,color 0.3s;}
body.dark .options-bar{background:#222;color:#eee;}
.options-bar label{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:0.95em;}
.shloka{margin-top:1.5em;margin-bottom:1.5em;padding:10px;background:white;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition: background 0.3s,color 0.3s;}
body.dark .shloka{background:#1e1e1e;color:#eee;}
.devanagari{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Devanagari',serif;}
body.dark .devanagari{color:#fff;}
.bengali{font-size:1.3em;font-weight:bold;color:#222;margin-bottom:2px;font-family:'Noto Serif Bengali',serif;}
body.dark .bengali{color:#fff;}
.iast{font-size:1.1em;font-style:italic;color:#555;}
body.dark .iast{color:#ccc;}
.dark-toggle{display:flex;justify-content:center;margin-bottom:1em;}
.dark-toggle button{padding:5px 10px;background:#333;color:#eee;border:none;border-radius:4px;cursor:pointer;transition: background 0.3s,color 0.3s;}
.dark-toggle button:active{background:#444;}
</style>
</head>
<body>

<h1>Stotram/Path Transliterator + Formatter</h1>

<div class="dark-toggle">
<button onclick="toggleDark()">Toggle Dark Mode</button>
</div>

<div class="textbox-container">
<textarea id="inputBox" placeholder="Paste or type text here..."></textarea>
<button class="copy-btn" onclick="copyText('inputBox', this)">Copy</button>
</div>

<div class="options-bar">
  <label><input type="checkbox" id="optDevanagari" checked> Devanagari</label>
  <label><input type="checkbox" id="optBengali"> Bengali</label>
  <label><input type="checkbox" id="optIAST" checked> IAST</label>
  <label><input type="checkbox" id="optDoubleDandaSpace"> Add space inside '॥ _ ॥' and '|| _ ||'</label>
</div>

<div class="textbox-container">
<textarea id="outputBox" placeholder="Output will appear here..." readonly></textarea>
<button class="copy-btn" onclick="copyText('outputBox', this)">Copy</button>
</div>

<script>
// ------------------- DARK MODE -------------------
function toggleDark(){ document.body.classList.toggle('dark'); }

// ------------------- SCRIPT DETECTION -------------------
function detectScript(text){
  if(/[ঀ-৿]/.test(text)) return 'ben';
  if(/[ऀ-ॿ]/.test(text)) return 'dev';
  if(/[A-Za-zāīūṛṝṅñṭḍṇśṣḥṃŗāīūŕṝoṃ]+/.test(text)) return 'iast';
  return 'unknown';
}

// ------------------- TRANS FUNCTIONS -------------------
function devanagariToIAST(text){ return text.replace(/ॐ/g,'oṃ'); /* implement mapping as before, simplified for brevity */ }
function devanagariToBengali(text){ return text.replace(/ॐ/g,'ওঁ'); /* implement mapping as before */ }
function transliterateIASTtoDevanagari(text){ return text.replace(/oṃ/g,'ॐ'); /* mapping */ }
function transliterateIASTtoBengali(text){ return text.replace(/oṃ/g,'ওঁ'); /* mapping */ }

// ------------------- COPY BUTTON -------------------
function copyText(id, btn){
  const textarea=document.getElementById(id);
  navigator.clipboard.writeText(textarea.value).then(()=>{
    const old=btn.textContent;
    btn.textContent='Copied!';
    setTimeout(()=>{btn.textContent=old;},1000);
  });
}

// ------------------- PROCESS INPUT -------------------
function processInput(){
  const inputText=document.getElementById("inputBox").value.trim();
  if(!inputText){document.getElementById("outputBox").value='';return;}
  const doubleDanda=document.getElementById("optDoubleDandaSpace").checked;

  let clusters=inputText.split(/\n{2,}/).map(c=>c.trim()).filter(c=>c);
  let output='';
  const script=detectScript(inputText);

  clusters.forEach(cluster=>{
    let clusterText=cluster.replace(/\s+$/gm,'');
    if(doubleDanda){
        clusterText = clusterText.replace(/॥\s*([\d०-९]*)\s*॥/g, (_, num)=> num ? `॥ ${num} ॥` : '॥  ॥');
        clusterText = clusterText.replace(/\|\|\s*(\d*)\s*\|\|/g, (_, num)=> num ? `|| ${num} ||` : '||  ||');
    }

    if(document.getElementById("optDevanagari").checked){
        if(script==='iast') output += transliterateIASTtoDevanagari(clusterText)+'\n';
        else output += clusterText+'\n';
    }

    if(document.getElementById("optBengali").checked){
        if(script==='iast') output += transliterateIASTtoBengali(clusterText)+'\n';
        else if(script==='dev') output += devanagariToBengali(clusterText)+'\n';
        else output += clusterText+'\n';
    }

    if(document.getElementById("optIAST").checked){
        if(script==='dev') output += devanagariToIAST(clusterText)+'\n';
        else output += clusterText+'\n';
    }

    output+='\n';
});
  
  document.getElementById("outputBox").value=output.trim();
}

// ------------------- AUTO-PROCESS -------------------
document.getElementById("inputBox").addEventListener('input',processInput);
document.getElementById("optDevanagari").addEventListener('change',processInput);
document.getElementById("optBengali").addEventListener('change',processInput);
document.getElementById("optIAST").addEventListener('change',processInput);
document.getElementById("optDoubleDandaSpace").addEventListener('change',processInput);
</script>
</body>
</html>
